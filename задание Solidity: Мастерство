import hre from "hardhat";
import "@nomicfoundation/hardhat-ethers/internal/type-extensions";

import { ethers } from "hardhat";

async function main() {
    const [deployer] = await ethers.getSigners();
    console.log("Ð”ÐµÐ¿Ð»Ð¾ÐµÑ€ :", deployer.address);

    //Ñ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸
    const Factory = await ethers.getContractFactory("Factory");
    const factory = await Factory.deploy();
    await factory.waitForDeployment();
    console.log("\n Ð“Ð»Ð°Ð²Ð½Ð°Ñ Ñ„Ð°Ð±Ñ€Ð¸ÐºÐ°:", await factory.getAddress());


    //Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹
    const TokenFactory = await ethers.getContractFactory("ERC20");

    // ÐŸÐ°Ñ€Ð° â„–1: Ð’Ð°Ð»ÑŽÑ‚Ñ‹
    const sgk = await TokenFactory.deploy("SGK Token", "SGK",18);
    const pgk = await TokenFactory.deploy("PGK Token", "PGK",18);

    // ÐŸÐ°Ñ€Ð° â„–2: Ð¢ÐµÑ…Ð½Ð¸ÐºÐ°
    const moskvich = await TokenFactory.deploy("Moskvich 3", "M-3",18);
    const tank = await TokenFactory.deploy("T-90 Tank", "TANK",18);

    await Promise.all([sgk.waitForDeployment(), pgk.waitForDeployment(), moskvich.waitForDeployment(), tank.waitForDeployment()]);
    console.log("Ð’Ð°Ð»ÑŽÑ‚Ñ‹: Ð¡Ð“Ðš, ÐŸÐ“Ðš, ÐœÐ¾ÑÐºÐ²Ð¸Ñ‡, Ð¢Ð°Ð½Ðº");
    //10 Ð¡Ð“Ðš Ð¼ÐµÐ½ÑÐµÐ¼ Ð½Ð° 1 ÐŸÐ“Ðš.
    console.log("\n Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð°Ñ€Ñƒ: Ð¡Ð“Ðš -> ÐŸÐ“Ðš (ÐšÑƒÑ€Ñ 2)");
    await factory.createPair(await sgk.getAddress(), await pgk.getAddress(), 2);
    const pairSgkAddress = await factory.getPair(await sgk.getAddress());

    //ÐœÐ¾ÑÐºÐ²Ð¸Ñ‡ 3 Ð¿Ð¾ Ñ†ÐµÐ½Ðµ 10 Ñ‚Ð°Ð½ÐºÐ¾Ð².
    console.log(" Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð°Ñ€Ñƒ: ÐœÐ¾ÑÐºÐ²Ð¸Ñ‡ 3 -> Ð¢Ð°Ð½ÐºÐ¸ (ÐšÑƒÑ€Ñ 10)");
    await factory.createPair(await moskvich.getAddress(), await tank.getAddress(), 10);
    const pairAutoAddress = await factory.getPair(await moskvich.getAddress());

    //ÐŸÐ“Ðš, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð²Ñ‹Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð¸Ñ… Ð·Ð° Ð¡Ð“Ðš
    await pgk.mint(pairSgkAddress, 1000);
    //Ð¢Ð°Ð½ÐºÐ¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð²Ñ‹Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð¸Ñ… Ð·Ð° ÐœÐ¾ÑÐºÐ²Ð¸Ñ‡Ð¸
    await tank.mint(pairAutoAddress, 500);

    console.log("\n Ð›Ð¸ÐºÐ²Ð¸Ð´Ð½Ð¾ÑÑ‚ÑŒ (ÐŸÐ“Ðš Ð¸ Ð¢Ð°Ð½ÐºÐ¸) Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð° Ð² Ð¾Ð±Ð¼ÐµÐ½Ð½Ð¸ÐºÐ¸.");
    // Ð”Ð°Ð´Ð¸Ð¼ ÑŽÐ·ÐµÑ€Ñƒ 10 Ð¡Ð“Ðš Ð¸ 1 ÐœÐ¾ÑÐºÐ²Ð¸Ñ‡
    await sgk.mint(deployer.address, 10);
    await moskvich.mint(deployer.address, 10);
    console.log("ðŸ‘¤ ÐžÐ»ÐµÐ¶ÐºÐ° Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»: 10 Ð¡Ð“Ðš Ð¸ 1 ÐœÐ¾ÑÐºÐ²Ð¸Ñ‡.");


    console.log("\n Ð¡Ð”Ð•Ð›ÐšÐ 1: ÐœÐµÐ½ÑÐµÐ¼ Ð¡Ð“Ðš Ð½Ð° ÐŸÐ“Ðš ");

    //ÐÐ¿Ñ€ÑƒÐ² (Ð Ð°Ð·Ñ€ÐµÑˆÐ°ÐµÐ¼ Ð¾Ð±Ð¼ÐµÐ½Ð½Ð¸ÐºÑƒ Ð·Ð°Ð±Ñ€Ð°Ñ‚ÑŒ Ð½Ð°ÑˆÐ¸ Ð¡Ð“Ðš)
    await sgk.allow(pairSgkAddress, 10);

    await factory.executeTrade(await sgk.getAddress(), 10);
    console.log(" Ð¡Ð´ÐµÐ»ÐºÐ° Ð¿Ñ€Ð¾ÑˆÐ»Ð°!");


    console.log("\nÐ¡Ð”Ð•Ð›ÐšÐ 2: Ð¡Ð´Ð°ÐµÐ¼ ÐœÐ¾ÑÐºÐ²Ð¸Ñ‡ Ð² Trade-In ");

    // ÐÐ¿Ñ€ÑƒÐ² (Ð Ð°Ð·Ñ€ÐµÑˆÐ°ÐµÐ¼ Ð·Ð°Ð±Ñ€Ð°Ñ‚ÑŒ ÐœÐ¾ÑÐºÐ²Ð¸Ñ‡)
    await moskvich.allow(pairAutoAddress, 10);
    //ÐžÐ±Ð¼ÐµÐ½
    await factory.executeTrade(await moskvich.getAddress(), 10);
    console.log(" Ð¡Ð´ÐµÐ»ÐºÐ° Ð¿Ñ€Ð¾ÑˆÐ»Ð°!");


    console.log("\n Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ñ‹Ðµ Ð±Ð°Ð»Ð°Ð½ÑÑ‹ ÐžÐ»ÐµÐ¶ÐºÐ¸:");

    const balSgk = await sgk.balanceOf(deployer.address);
    const balPgk = await pgk.balanceOf(deployer.address);
    const balCar = await moskvich.balanceOf(deployer.address);
    const balTank = await tank.balanceOf(deployer.address);

    console.log(`Ð¡Ð“Ðš:      ${balSgk} `);//Ð‘Ñ‹Ð»Ð¾ 10, Ð´Ð¾Ð»Ð¶Ð½Ð¾ ÑÑ‚Ð°Ñ‚ÑŒ 0
    console.log(`ÐŸÐ“Ðš:      ${balPgk} `);//Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒÑÑ 20, Ñ‚.Ðº. ÐºÑƒÑ€Ñ 2
    console.log(`ÐœÐ¾ÑÐºÐ²Ð¸Ñ‡Ð¸: ${balCar} `);//Ð±Ñ‹Ð»Ð¾ 1 ,Ð¾Ð±Ð¼ÐµÐ½ÑÐ»Ð¸
    console.log(`Ð¢Ð°Ð½ÐºÐ¸:    ${balTank} `);//Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ 10, Ñ‚.Ðº. ÐºÑƒÑ€Ñ 10
}

main().catch((error) => {
    console.error(error);
    process.exitCode = 1;
});

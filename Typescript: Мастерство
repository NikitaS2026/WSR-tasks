import * as readline from 'readline/promises';
import { stdin as input, stdout as output } from 'process';
import * as path from "node:path";
import * as fs from 'fs'
enum Rarity {
    Common = "Common",
    Rare = "Rare",
    Legendary = "Legendary"
}
class Monkey {
    id: number;
    name: string;
    age: number;
    rarity: Rarity;
    isSold: boolean = false;

    constructor(id: number, name: string, age: number, rarity: Rarity) {
        this.id = id;
        this.name = name;
        this.age = age;
        this.rarity = rarity;
    }

    getInfo(): string {
        const status = this.isSold ? "–ø—Ä–æ–¥–∞–Ω–∞" : "–≤ –ø—Ä–æ–¥–∞–∂–µ";
        return `ID: ${this.id}, –ò–º—è: ${this.name}, –í–æ–∑—Ä–∞—Å—Ç: ${this.age}, –†–µ–¥–∫–æ—Å—Ç—å: ${this.rarity}, –°—Ç–∞—Ç—É—Å: ${status}`;
    }

    sell(): void {
        this.isSold = true;
    }
}

class RobotMonkey extends Monkey {
    chipVersion: string;
    constructor(id: number, name: string, age: number, rarity: Rarity, chipVersion: string) {
        super(id, name, age, rarity)
        this.chipVersion = chipVersion;
    }
    override getInfo(): string {
        return `${super.getInfo()}, —á–∏–ø –≤–µ—Ä—Å–∏—è: ${this.chipVersion}`;
    }
}

class MagicMonkey extends Monkey {
    manaPool: number;

    constructor(id: number, name: string, age: number, rarity: Rarity, manaPool: number) {
        super(id, name, age, rarity)
        this.manaPool = manaPool;
    }
    override getInfo(): string {
        return `${super.getInfo()}, –Ω–∞—Ä–º–∞–Ω–∞: ${this.manaPool}`;
    }
}
class MonkeyMarket {
    monkeys: Monkey[] = [];
    private nextId: number = 21;

    getMonkeys(): Monkey[] {
        return this.monkeys;
    }

    setMonkeys(monkeys12: Monkey[]) {
        this.monkeys = monkeys12;
    }

    addMonkey(monkey: Monkey): void {
        this.monkeys.push(monkey);
    }

    // –ù–æ–≤—ã–π –º–µ—Ç–æ–¥: —Å–æ–∑–¥–∞–µ—Ç –º–∞—Ä—Ç—ã—à–∫—É —Å–∞–º –∏ –¥–∞–µ—Ç –µ–π –∞–≤—Ç–æ-ID
    addMonkeyFromConsole(name: string, age: number, rarityString: string): void {
        const id = this.nextId++;

        let rarity = Rarity.Common;
        if (rarityString.toLowerCase() === 'rare') rarity = Rarity.Rare;
        if (rarityString.toLowerCase() === 'legendary') rarity = Rarity.Legendary;

        const newMonkey = new Monkey(id, name, age, rarity);
        this.monkeys.push(newMonkey);
        console.log(`\n –ú–∞—Ä—Ç—ã—à–∫–∞ "${name}" –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å ID ${id}!`);
    }
    getAvailableMonkeys(): Monkey[] {
        return this.monkeys.filter(m => !m.isSold);
    }

    buyMonkey(id: number): string {
        const monkey = this.monkeys.find(m => m.id === id);
        if (!monkey) return `–†–∞–± —Å id=${id} –Ω–µ –Ω–∞–π–¥–µ–Ω, —É–±–µ–∂–∞–ª.`;
        if (monkey.isSold) return ` –†–∞–± "${monkey.name}" —É–∂–µ –ø—Ä–æ–¥–∞–Ω,–æ–ø–∞–∑–¥–∞–ª –¥—Ä—É–∂–æ—á–µ–∫.`;

        monkey.sell();
        return ` –í—ã —É—Å–ø–µ—à–Ω–æ –∫—É–ø–∏–ª–∏ –ª–∏—á–Ω–æ–≥–æ —Ä–∞–±–∞ "${monkey.name}"!`;
    }
}
const market = new MonkeyMarket();

// –û–±—ã—á–Ω—ã–µ
market.addMonkey(new Monkey(1, "–ú–∏–ª—Ñ–∞", 52, Rarity.Rare));
market.addMonkey(new Monkey(2, "–ù–∏–∫–∏—Ç–∫–∞", 18, Rarity.Rare));
market.addMonkey(new Monkey(3, "–ê–ª–µ–Ω–∞–î–∂–∞–Ω", 2005, Rarity.Legendary));
market.addMonkey(new Monkey(4, "–ú–æ—Å–∫–≤–∏—á", 2, Rarity.Legendary));
market.addMonkey(new Monkey(5, "–ß–µ—Ä–Ω–æ–∂—ë–ø—ã–π", 30, Rarity.Common));
market.addMonkey(new Monkey(6, "–Æ–ª—è–°–æ—Å–æ–∫", 18, Rarity.Legendary));
market.addMonkey(new Monkey(7, "–ö–∞—á—ë–∫", 17, Rarity.Common));
market.addMonkey(new Monkey(8, "–ù–∞—â—è–ª—å–Ω–∏–∫–∞–∞–∞–∞–∞–∞", 28, Rarity.Legendary));
market.addMonkey(new Monkey(9, "–û—Ç–µ—Ü–û–ª–µ–≥", 29, Rarity.Common));

// –†–æ–±–æ—Ç—ã
market.addMonkey(new RobotMonkey(10, "–º–µ–≥–∞_—É–ª—å—Ç—Ä–∞_—Å—É–ø–µ—Ä_–ê–ª—ë–Ω–∞", 200, Rarity.Legendary, "v2005.9.5"));
market.addMonkey(new RobotMonkey(11, "–ö–∏–±–µ—Ä–û–ª–µ–≥", 18, Rarity.Legendary, "v1.0"));
market.addMonkey(new RobotMonkey(12, "–ß—ë—Ä–Ω—ã–π–†–∞–±–°–∏—Å—Ç–µ–º—ã", 200, Rarity.Legendary, "v0.1.0"));
market.addMonkey(new RobotMonkey(13, "–Æ–ª—è—à–∫–µ—Ä", 200, Rarity.Legendary, "v2007.05.27"));
market.addMonkey(new RobotMonkey(14, "–ù–µ—É—á_–Ø", 200, Rarity.Legendary, "v2007.07.03"));

// –ú–∞–≥–∏—á–µ—Å–∫–∏–µ (15-20)
market.addMonkey(new MagicMonkey(15, "–ì–∞—Ä–∏–∫–ü–æ—Ç–µ—Ä", 99, Rarity.Legendary, 123456));
market.addMonkey(new MagicMonkey(16, "–ì–∞—Ä–∏–∫–•–∞—Ä–ª–∞–º–æ–≤", 49, Rarity.Legendary, 1945));
market.addMonkey(new MagicMonkey(17, "–ï–≤—Ä–µ–π", 0, Rarity.Legendary, 1945));
market.addMonkey(new MagicMonkey(18, "–û–∫–∞–∫–∞", 1, Rarity.Legendary, 111111));
market.addMonkey(new MagicMonkey(19, "–ü–µ–ª—å–º–µ–Ω–µ–ü–æ–¥–∞–≤–∞—Ç–µ–ª—å", 18, Rarity.Legendary, 223322));
market.addMonkey(new MagicMonkey(20, "–í—Å–µ–ª—è—é–ñ–∞–ª–æ—Å—Ç—å", 52, Rarity.Legendary, 123456789));

// --- –ö–û–ù–°–û–õ–¨–ù–û–ï –ú–ï–ù–Æ ---

async function main() {
    const rl = readline.createInterface({ input, output });
    let isRunning = true;

    while (isRunning) {
        console.log("\nüë®üèø MONKEY-RAB MARKETüë®üèø ");
        console.log("1 - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –º–∞—Ä—Ç—ã—à–∫—É (Auto ID)");
        console.log("2 - –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö");
        console.log("3 - –ö—É–ø–∏—Ç—å –º–∞—Ä—Ç—ã—à–∫—É");
        console.log("4- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä—ã–Ω–æ–∫ –≤ —Ñ–∞–π–ª");
        console.log("5- –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä—ã–Ω–æ–∫ –∏–∑ —Ñ–∞–π–ª–∞");
        console.log("exit - –í—ã–π—Ç–∏");

        const command = await rl.question("\n–í–∞—à –≤—ã–±–æ—Ä > ");

        switch (command.trim()) {
            case "1":
                // –¢—É—Ç –º—ã —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –æ—á–µ—Ä–µ–¥–∏
                const name = await rl.question("–ò–º—è –º–∞—Ä—Ç—ã—à–∫–∏: ");
                const ageStr = await rl.question("–í–æ–∑—Ä–∞—Å—Ç: ");
                const rarityStr = await rl.question("–†–µ–¥–∫–æ—Å—Ç—å (Common/Rare/Legendary): ");

                const age = parseInt(ageStr) || 0;
                market.addMonkeyFromConsole(name, age, rarityStr);
                break;
            case "2":
                const available = market.getAvailableMonkeys();
                console.log("\nüèéÔ∏èNIGGA_MONKEY –ú–∞–≥–∞–∑–∏–Ω(–ß–µ—Ä–Ω—ã–π —Ä—ã–Ω–æ–∫)üèéÔ∏è" );
                // –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ —Ç–∞–±–ª–∏—Ü—ã
                console.table(available, ['id', 'name', 'age', 'rarity', 'chipVersion', 'manaPool']);
                break;

            case "3":
                const idStr = await rl.question("–í–≤–µ–¥–∏—Ç–µ ID –º–∞—Ä—Ç—ã—à–∫–∏: ");
                const result = market.buyMonkey(parseInt(idStr));
                console.log(result);
            case "4":
                const dataSave = JSON.stringify(market.getMonkeys());
                console.log(dataSave);
                const file1 = path.join(__dirname,"..","monkeys_data.json")
                fs.writeFileSync(file1,dataSave);
                console.log(`–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ `)
                console.log(`–ü—É—Ç—å –∫ –º–∞—Ä—Ç—ã—Ö–µ: ${file1}`)
                console.log(`–î–∞–Ω–Ω—ã–µ: ${dataSave} `);
                break;
            case "5":
                const filePath =   path.join(__dirname,"..","monkeys_data.json");
                const data = fs.readFileSync(filePath).toString()
                const dataS = JSON.parse(data)
                console.log(dataS)
                if (fs.existsSync(filePath))
                    market.setMonkeys(dataS)
                    console.log(`–∑–∞–≥—Ä—É–∂–µ–Ω–æ `)
                break

            case "exit":
                console.log("ü•∫–ü–∞–∫–µ–¥–∞!ü•∫ –ü—Ä–∏—Ö–æ–¥–∏—Ç–µ –∑–∞ –ª—é–¥—å–º–∏,—à—É—á—É, –∑–∞ –±–∞–Ω–∞–Ω–∞–º–∏.ü•∫");
                isRunning = false;
                break;

            default:
                console.log("üíî–Ø —Ö–∑ —á—Ç–æ —ç—Ç–æ –±—Ä–∞—Ç. –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.üíî");
        }
    }
    rl.close();
}

// –ó–∞–ø—É—Å–∫
main();1
